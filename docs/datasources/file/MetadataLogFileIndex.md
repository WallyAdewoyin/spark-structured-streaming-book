# MetadataLogFileIndex

`MetadataLogFileIndex` is a `PartitioningAwareFileIndex` of <<allFilesFromLog, metadata log files>> (generated by [FileStreamSink](FileStreamSink.md)).

`MetadataLogFileIndex` is <<creating-instance, created>> when:

* `DataSource` (Spark SQL) is requested to resolve a `FileFormat` relation (`resolveRelation`) and creates a `HadoopFsRelation`

* `FileStreamSource` is requested to [allFilesUsingMetadataLogFileIndex](FileStreamSource.md#allFilesUsingMetadataLogFileIndex)

[[logging]]
[TIP]
====
Enable `ALL` logging level for `org.apache.spark.sql.execution.streaming.MetadataLogFileIndex` to see what happens inside.

Add the following line to `conf/log4j.properties`:

```
log4j.logger.org.apache.spark.sql.execution.streaming.MetadataLogFileIndex=ALL
```

Refer to <<spark-sql-streaming-spark-logging.md#, Logging>>.
====

=== [[creating-instance]] Creating MetadataLogFileIndex Instance

`MetadataLogFileIndex` takes the following to be created:

* [[sparkSession]] `SparkSession`
* [[path]] Hadoop's https://hadoop.apache.org/docs/r2.8.3/api/org/apache/hadoop/fs/Path.html[Path]
* [[userSpecifiedSchema]] User-defined schema (`Option[StructType]`)

`MetadataLogFileIndex` initializes the <<internal-properties, internal properties>>.

While being created, `MetadataLogFileIndex` prints out the following INFO message to the logs:

```
Reading streaming file log from [metadataDirectory]
```

=== [[internal-properties]] Internal Properties

[cols="30m,70",options="header",width="100%"]
|===
| Name
| Description

| metadataDirectory
a| [[metadataDirectory]] *Metadata directory* (Hadoop's https://hadoop.apache.org/docs/r2.8.3/api/org/apache/hadoop/fs/Path.html[Path] of the [_spark_metadata](FileStreamSink.md#metadataDir) directory under the <<path, path>>)

Used when...FIXME

| metadataLog
a| [[metadataLog]] [FileStreamSinkLog](FileStreamSinkLog.md) (with the <<metadataDirectory, _spark_metadata directory>>)

| allFilesFromLog
a| [[allFilesFromLog]] *Metadata log files*

|===
